@model ATable.Models.PanierModel

@{
    ViewBag.Title = "Details";

    int idRestaurantPanier = 0;

    if (ViewBag.Error == "error")
    {
        idRestaurantPanier = ViewBag.IdRestaurantPanier;

        <script type="text/javascript">
            window.onload = function () {
                $('#modalErreur').openModal();
            };
        </script>
    }

    List<ATable.Models.Menu> menu = ViewBag.Menu;
    List<ATable.Models.Produit> entree = ViewBag.Entree;
    List<ATable.Models.Produit> plat = ViewBag.Plat;
    List<ATable.Models.Produit> dessert = ViewBag.Dessert;

    ATable.Models.Restaurant restaurant = ViewBag.Restaurant;
    ATable.Models.Utilisateur utilisateur = ViewBag.User;
}


<div class="menu">
    <ul id="slide-out" class="side-nav fixed main-side side-nav-menu">
        <li class="user-li">
            <div class="user-view">
                <div class="background">
                </div>
                @if (utilisateur != null)
                {
                    <div class="center-align">
                        <a href="@Url.Action("MonCompte", "Utilisateurs", new { id = utilisateur.IdUtilisateur })"><i class="fas fa-user fa-2x"></i>&nbsp;&nbsp;@utilisateur.Prenom&nbsp;@utilisateur.Nom</a>
                    </div>
                }
                else
                {
                    <div class="center-align">
                        <a href="@Url.Action("Connexion", "Utilisateurs", new { idFromRestaurant = restaurant.IdRestaurant })"><i class="fas fa-sign-in-alt fa-lg"></i>&nbsp;&nbsp;Se Connecter</a>
                    </div>
                }
            </div>
        </li>
        <li class="btn-li center-align">
            <a class="waves-effect waves-light navPanier" onclick="toast()">
                <i class="fas fa-shopping-basket fa-2x"></i>&nbsp;&nbsp;Panier :&nbsp;&nbsp;<span class="total" style="font-size:20px;">0</span>€<sup>&nbsp;TTC</sup>
            </a>
        </li>
        <li class="lone sidePanier">
        </li>
    </ul>
</div>

<div class="row">
    <div class="col s12 m12 l9 offset-l2 xl10 offset-xl2">

        <div class="col s12">
            <div class="row card card-small horizontal">
                <div class="card-image col m4 pl-0 hide-on-small-and-down">
                    <img class="materialboxed" src="~/Images/restaurants/@restaurant.Photos.First().Nom">
                </div>
                <div class="card-stacked col s12 m8">
                    <div class="card-content">
                        <h4 class="courgette mt-0" style="text-decoration:underline;">@restaurant.Nom</h4>
                        <hr />
                        <div class="row">
                            <div class="chip  deep-orange lighten-3 left">
                                @restaurant.TypeCuisine.Nom
                            </div>
                            <div class="chip  teal lighten-3 right">
                                @restaurant.Budget
                            </div>
                        </div>
                        <p>@restaurant.Description</p>
                    </div>
                </div>
            </div>
        </div>


        <div class="box carte-collapsible">

            <ul class="collapsible popout ">
                <li>
                    <div class="collapsible-header hoverable categorie-collapsible"><h3>Menus</h3></div>
                    <div class="collapsible-body">
                        <table class="bordered">
                            <tbody>
                                @foreach (var item in menu)
                                {
                                    <tr>
                                        <td class="hide-on-small-and-down">
                                        </td>
                                        <td class="title-product">
                                            @item.Nom
                                        </td>
                                        <td class="hide-on-small-and-down">
                                        </td>
                                        <td style="min-width:60px">
                                            @item.Prix €
                                        </td>
                                        <td style="min-width:40px">
                                            <button class="btn-floating btn-small waves-effect waves-light red" onclick="openMenu(@item.IdMenu)"><i class="material-icons">add</i></button>
                                        </td>
                                    </tr>

                                }
                            </tbody>
                        </table>
                    </div>
                </li>
                <li>
                    <div class="collapsible-header hoverable categorie-collapsible"><h3>Entrées</h3></div>
                    <div class="collapsible-body">
                        <table class="bordered">
                            <tbody>
                                @foreach (var item in entree)
                                {
                                    <tr>
                                        <td class="hide-on-small-and-down">
                                            <img src="~/Images/plats/@item.Photos.First().Nom" style="max-width:140px;" />
                                        </td>
                                        <td class="title-product">
                                            @item.Nom
                                        </td>
                                        <td class="hide-on-small-and-down">
                                            @item.Description
                                        </td>
                                        <td style="min-width:60px">
                                            @item.Prix €
                                        </td>
                                        <td style="min-width:40px">
                                            <button class="btn-floating btn-small waves-effect waves-light red add" data-idproduit=@item.IdProduit><i class="material-icons">add</i></button>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </li>
                <li>
                    <div class="collapsible-header hoverable categorie-collapsible"><h3>Plats</h3></div>
                    <div class="collapsible-body">
                        <table class="bordered">
                            <tbody>
                                @foreach (var item in plat)
                                {
                                    <tr>
                                        <td class="hide-on-small-and-down">
                                            <img src="~/Images/plats/@item.Photos.First().Nom" style="max-width:140px;" />
                                        </td>
                                        <td class="title-product">
                                            @item.Nom
                                        </td>
                                        <td class="hide-on-small-and-down">
                                            @item.Description
                                        </td>
                                        <td style="min-width:60px">
                                            @item.Prix €
                                        </td>
                                        <td style="min-width:40px">
                                            <button class="btn-floating btn-small waves-effect waves-light red add" data-idproduit=@item.IdProduit><i class="material-icons">add</i></button>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </li>
                <li>
                    <div class="collapsible-header hoverable categorie-collapsible"><h3>Desserts</h3></div>
                    <div class="collapsible-body">
                        <table class="bordered">
                            <tbody>
                                @foreach (var item in dessert)
                                {
                                    <tr>
                                        <td class="hide-on-small-and-down">
                                            <img src="~/Images/plats/@item.Photos.First().Nom" style="max-width:140px;" />
                                        </td>
                                        <td class="title-product">
                                            @item.Nom
                                        </td>
                                        <td class="hide-on-small-and-down">
                                            @item.Description
                                        </td>
                                        <td style="min-width:60px">
                                            @item.Prix €
                                        </td>
                                        <td style="min-width:40px">
                                            <button class="btn-floating btn-small waves-effect waves-light red add" data-idproduit=@item.IdProduit><i class="material-icons">add</i></button>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>

<!--Modal d'annulation panier-->
<div id="modalErreur" class="modal">
    <div class="modal-content">
        <h4>Attention, votre panier contient déjà des produits !</h4>
        <p>
            Votre panier contient des produits d'un autre restaurant.
            Pour rappel, vous pouvez uniquement commander auprès d'un seul restaurateur à la fois.
            Souhaitez-vous poursuivre la commande en cours ou bien vider votre panier et poursuivre chez un autre restaurateur ?
        </p>
    </div>
    <div class="modal-footer">
        <a onclick="clearPanier()" class="modal-close waves-effect waves-red btn-flat">Vider mon panier</a>
        <a href=@Url.Action("Details","Restaurants", new { id = idRestaurantPanier }) class="waves-effect waves-green btn-flat">Continuer ma commande</a>
    </div>
</div>



<!--Modal commande Menu -->

<div id="modalMenu" class="modal modal-menu">
    <div class="row mb-0">
        <div class="col s4 center-align">
            <h4 class="pt-1">Votre Menu</h4>
            <div class="flow-text">
                <img class="responsive-img" src="~/Images/plats/plateausignature.jpg" />
                <h5>Menu A</h5>
                <p>Nondum nihil ne in fame scaphas tum luna tum plerumque petivere splendore degressi omnibus viles.</p>
            </div>

        </div>
        <div class="col s8 center-align" style="border-left: 1px solid #cdd0d4;">
            <h4 class="courgette pt-1">Composez votre menu à la carte !</h4>

            <ul id="tabs-menu" class="tabs">
                <li class="tab col s3"><a class="active" href="#entree">Entrée</a></li>
                <li class="tab col s3"><a href="#plat">Plat</a></li>
                <li class="tab col s3"><a href="#dessert">Dessert</a></li>
            </ul>
            <div id="entree" class="col s12 grey lighten-5">
                <div class="row">
                    <div class="col s12 m4">
                        <div class="card-panel hoverable">
                            <img src="~/Images/plats/foiegras.jpg" class="responsive-img" />
                            <span></span>
                            <div class="row">
                                <button class="btn-floating btn-medmini waves-effect waves-light red remove"><i class="material-icons">remove</i></button>
                                2
                                <button class="btn-floating btn-medmini waves-effect waves-light red add"><i class="material-icons">add</i></button>
                            </div>
                        </div>
                    </div>
                    <div class="col s12 m4">
                        <div class="card-panel hoverable">
                            <img src="~/Images/plats/foiegras.jpg" class="responsive-img" />
                            <span></span>
                            <div class="row">
                                <button class="btn-floating btn-mini waves-effect waves-light red remove"><i class="material-icons">remove</i></button>
                                <button class="btn-floating btn-mini waves-effect waves-light red add"><i class="material-icons">add</i></button>
                            </div>
                        </div>
                    </div>
                    <div class="col s12 m4">
                        <div class="card-panel hoverable">
                            <img src="~/Images/plats/foiegras.jpg" class="responsive-img" />
                            <span></span>
                            <div class="row">
                                <button class="btn-floating btn-mini waves-effect waves-light red remove"><i class="material-icons">remove</i></button>
                                <button class="btn-floating btn-mini waves-effect waves-light red add"><i class="material-icons">add</i></button>
                            </div>
                        </div>
                    </div>
                    <div class="col s12 m4">
                        <div class="card-panel hoverable">
                            <img src="~/Images/plats/foiegras.jpg" class="responsive-img" />
                            <span></span>
                            <div class="row">
                                <button class="btn-floating btn-mini waves-effect waves-light red remove"><i class="material-icons">remove</i></button>
                                <button class="btn-floating btn-mini waves-effect waves-light red add"><i class="material-icons">add</i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="plat" class="col s12 grey lighten-4">

            </div>
            <div id="dessert" class="col s12 grey lighten-5">
            </div>
        </div>
    </div>
    <div class="row mb-0">
        <div class="col s4 center-align">
            <span class="col s12 price-modal z-depth-3"><h5>16,90 €</h5></span>
        </div>
        <div class="col s8 center-align" style="border-left: 1px solid #cdd0d4;">
            <div class="col s3">
                <button class="waves-effect waves-light btn-large previous">Précédent</button>
            </div>
            <div class="col s3 offset-s6">
                <button class="waves-effect waves-light btn-large next">Suivant</button>
            </div>
        </div>
    </div>






    @section Scripts {
        <script>
        $(document).ready(function () {
            $('.materialboxed').materialbox();

            $('.side-nav li').click(function () {
                $('.side-nav li.active').removeClass('active');
                $(this).closest('li').addClass('active');
            });

        });




        function openMenu(idMenu) {
            $('#modalMenu').openModal();
        };


        @*function openMenu(idMenu) {
            var data = { 'idMenu' : idMenu };

            $.ajax({
                url: '@Url.Action("GetMenu", "WebService")',
                    type: 'POST',
                    data: JSON.stringify(data),
                    contentType: 'application/json; charset=utf-8',
                    DataType: 'json',
                    success: function (data) {
                        $('#modalMenu').openModal();
                        alert(data.entrees);
                    },
                    error: function () {
                        alert('Error');
                    }
            });
        };*@

        function clearPanier() {
                var data = {'idSession': '@Session.SessionID' };

                $.ajax({
                    url: '@Url.Action("ClearPanier", "WebService")',
                    type: 'POST',
                    data: JSON.stringify(data),
                    contentType: 'application/json; charset=utf-8',
                    DataType: 'json',
                    success: function (data) {
                        getPanierHtml();
                        $('#modalErreur').close();
                    },
                    error: function () {
                        alert('Error');
                    }
                });
        };

        $(".add").click(function () {

                var data = { 'idProduit' : $(this).data('idproduit'), 'idSession': '@Session.SessionID' };

                $.ajax({
                    url: '@Url.Action("AddProduit", "WebService")',
                    type: 'POST',
                    data: JSON.stringify(data),
                    contentType: 'application/json; charset=utf-8',
                    DataType: 'json',
                    success: function (data) {
                        $('.sidePanier').html(data.panier);
                        $('.total').html(data.total);
                    },
                    error: function () {
                        alert('Error');
                    }
                });
            });

        function removeProduit(idProduit) {
            var data = { 'idProduit': idProduit, 'idSession': '@Session.SessionID' };

                $.ajax({
                    url: '@Url.Action("RemoveProduit", "WebService")',
                    type: 'POST',
                    data: JSON.stringify(data),
                    contentType: 'application/json; charset=utf-8',
                    DataType: 'json',
                    success: function (data) {
                        $('.sidePanier').html(data.panier);
                        $('.total').html(data.total);
                    },
                    error: function () {
                        alert('Error');
                    }
                });
        }



        </script>
    }
